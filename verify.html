<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/favicon.ico">
    <title>verification</title>
    <!-- Bootstrap core CSS -->
    <link href="css/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./css/css/verify.css">

</head>

<body>
    <div class="background">
        <div class="auth-container">
            <div class="auth-logo">
                <img src="./img/logo.jpg" alt="Fly Protect">
            </div>
            <h2>Two-Factor Authentication</h2>
            <p>Open the two-step verification app on your mobile device to get your verification code.</p>
            <form>
                <div class="auth-input">
                    <input type="text" id="auth-code" name="auth-code" placeholder="Authentication code" required>
                    <span class="auth-icon">&#10004;</span>
                </div>
                <div id="alert_verify" style="text-align: center;"></div>
                <button type="submit" class="auth-button" id="authenticate">Authenticate</button>
            </form>
            <a href="./login.html" class="back-link">Back to basic login</a>
        </div>

    </div>
</body>
<script src="js/axios/dist/axios.js"></script>
<script src="js/jquery-3.4.1.js"></script>
<script src="css/dist/js/bootstrap.min.js"></script>
<script src="js/offcanvas.js"></script>

<script type="text/javascript">
    $.getJSON('../conf/ui.conf', function (data) {
        document.getElementById("authenticate").addEventListener('click', function (e) {
            var Ip = data.master.ip;
            var Port = data.master.port;
            console.log(Ip)
            console.log(Port)
            var user = localStorage.getItem("user")
            var url = `https://${Ip}:${Port}/v1/master/verify-login`;
            var otpVerify = true;
            var jsonVerify = {};
            jsonVerify["OTP"] = document.getElementById('auth-code').value;
            jsonVerify["Username"] = user;
            var userVerify = JSON.stringify(jsonVerify);
            e.preventDefault();
            axios({
                method: 'post',
                url: url,
                timeout: 30000,
                withCredentials: true,
                data: userVerify
            })
                .then(response => {
                    console.log("response", response)
                    document.cookie = response.data;
                    localStorage.setItem('otp-verify', otpVerify)
                    document.getElementById('alert_verify').innerHTML = 'Verify OTP successfully!';
                    document.getElementById('alert_verify').style.color = 'green';
                    setTimeout(() => {
                        document.location.href = 'index.html';
                    }, 1000)
                })
                .catch(error => {
                    console.error("error: ", error)
                    document.getElementById('alert_verify').innerHTML = 'Invalid OTP. Please try again.';
                    document.getElementById('alert_verify').style.color = 'red';
                })
        })
    })
</script>

</html>